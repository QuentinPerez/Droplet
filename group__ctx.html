<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Droplet: Contexts</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Droplet
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Contexts</div>  </div>
</div><!--header-->
<div class="contents">

<p>State for communicating with a cloud service.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga0713bc91714b552815fef12bd23d831f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structdpl__ctx.html">dpl_ctx_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ctx.html#ga0713bc91714b552815fef12bd23d831f">dpl_ctx_new</a> (const char *droplet_dir, const char *profile_name)</td></tr>
<tr class="memdesc:ga0713bc91714b552815fef12bd23d831f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a context.  <a href="#ga0713bc91714b552815fef12bd23d831f"></a><br/></td></tr>
<tr class="memitem:ga08c25be6447458a46f86f495bc12576e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structdpl__ctx.html">dpl_ctx_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ctx.html#ga08c25be6447458a46f86f495bc12576e">dpl_ctx_new_from_dict</a> (const <a class="el" href="structdpl__dict.html">dpl_dict_t</a> *profile)</td></tr>
<tr class="memdesc:ga08c25be6447458a46f86f495bc12576e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates a new context with the profile specified in a dict.  <a href="#ga08c25be6447458a46f86f495bc12576e"></a><br/></td></tr>
<tr class="memitem:ga9fea3ced0eddc26fac4ab7b6618a4eff"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ctx.html#ga9fea3ced0eddc26fac4ab7b6618a4eff">dpl_ctx_free</a> (<a class="el" href="structdpl__ctx.html">dpl_ctx_t</a> *ctx)</td></tr>
<tr class="memdesc:ga9fea3ced0eddc26fac4ab7b6618a4eff"><td class="mdescLeft">&#160;</td><td class="mdescRight">Free a context.  <a href="#ga9fea3ced0eddc26fac4ab7b6618a4eff"></a><br/></td></tr>
</table>
<a name="details" id="details"></a><h2>Detailed Description</h2>
<p>The <code>dpl_ctx_t</code> object, or "context", holds all the state and options needed to communicate with a cloud service instance. All other functions that perform operations on a cloud service require a context. Thus, creating a context is one of the very first things which a program will do when using Droplet, just after calling <code><a class="el" href="group__init.html#ga2addc19dfa3e6d88e2133af59b2fd1ed" title="Initialize Droplet global data.">dpl_init()</a></code>.</p>
<p>Most programs will only ever create a single context object and will keep it for the lifetime of the program, only freeing it just before calling <code><a class="el" href="group__init.html#ga828501f4e64a7c0029f26d3517bebb15" title="Free Droplet global data.">dpl_free()</a></code> and exiting. This is not the only possible approach but it makes the most sense because</p>
<ul>
<li>The context holds some static configuration data which is read from a profile file when the context is created. Reading this data is expensive, and it does not change. </li>
<li>The context caches connections to cloud service hosts, which allows re-use of connections between requests and thus amortises connection setup latency (such as DNS and TCP roundtrip latency) over multiple requests. </li>
<li>Most programs only need to communicate with a single cloud storage service instance, so there's no need to create a second context.</li>
</ul>
<p>An important parameter of the context is the droplet directory, which is established when the context is created. Several important files are located relative to this directory, notably the profile file. See the description of <code><a class="el" href="group__ctx.html#ga0713bc91714b552815fef12bd23d831f" title="Create a context.">dpl_ctx_new()</a></code> for details.</p>
<p>The context object is thread-safe and contains an internal mutex which is used to safely share access between multiple threads. This mutex is not held while requests are being made to the back end. If you need to make requests to a cloud service from multiple threads in the same process, just create a single context object and share it between all threads. </p>
<h2>Function Documentation</h2>
<a class="anchor" id="ga9fea3ced0eddc26fac4ab7b6618a4eff"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dpl_ctx_free </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdpl__ctx.html">dpl_ctx_t</a> *&#160;</td>
          <td class="paramname"><em>ctx</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Free a context created earlier by <code><a class="el" href="group__ctx.html#ga0713bc91714b552815fef12bd23d831f" title="Create a context.">dpl_ctx_new()</a></code>. All resources associated with the context (e.g. profile data and cached connections) are freed.</p>
<dl class="section note"><dt>Note</dt><dd>If you use the connection API to create your own connections, you <b>must</b> release all your connections created from this context, by calling either <code><a class="el" href="conn_8c.html#a41aa671aaccf98d93d7ba95effaa9714" title="Release the connection after use.">dpl_conn_release()</a></code> or <code><a class="el" href="conn_8c.html#ab154b8b87903ed148f1d7a959907d063" title="Release and immediately terminate a connection.">dpl_conn_terminate()</a></code>, <b>before</b> calling <code><a class="el" href="group__ctx.html#ga9fea3ced0eddc26fac4ab7b6618a4eff" title="Free a context.">dpl_ctx_free()</a></code>. </dd></dl>

</div>
</div>
<a class="anchor" id="ga0713bc91714b552815fef12bd23d831f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structdpl__ctx.html">dpl_ctx_t</a>* dpl_ctx_new </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>droplet_dir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>profile_name</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Creates and returns a new <code>dpl_ctx_t</code> object, or NULL on error.</p>
<p>Possible errors include memory allocation failure, failure to find the profile, and failure to parse the profile. </p>
<dl class="section note"><dt>Note</dt><dd>If this function fails there is no way for the caller to discover what went wrong.</dd></dl>
<p>The droplet directory is used as the base directory for finding several important files, notably the profile file. It is the first non-NULL pathname of: </p>
<ul>
<li>the parameter <em>droplet_dir</em>, or </li>
<li>the environmental variable <code>DPLDIR</code>, or </li>
<li><code>"~/.droplet/"</code>.</li>
</ul>
<p>A profile file is read to set up options for the context. The profile file is named <code>&lt;name&gt;.profile</code> where <code>&lt;name&gt;</code> is the profile's name, and is located in the droplet directory. The profile's name is the first non-NULL name of: </p>
<ul>
<li>the <em>profile_name</em> parameter, or </li>
<li>the environment variable <code>DPLPROFILE</code>, or </li>
<li><code>"default"</code>.</li>
</ul>
<p>Thus, if both parameters are passed <code>NULL</code> the profile will be read from the file <code>~/.droplet/default.profile</code>.</p>
<p>See <a class="el" href="profile.html">Profile File</a> for details of the profile file format.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">droplet_dir</td><td>pathname of directory containing Droplet state, or <code>NULL</code> </td></tr>
    <tr><td class="paramname">profile_name</td><td>name of the profile to use, or <code>NULL</code> </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>a new context, or NULL on error </dd></dl>

</div>
</div>
<a class="anchor" id="ga08c25be6447458a46f86f495bc12576e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structdpl__ctx.html">dpl_ctx_t</a>* dpl_ctx_new_from_dict </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structdpl__dict.html">dpl_dict_t</a> *&#160;</td>
          <td class="paramname"><em>profile</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Creates a new profile and sets up the the profile information from a dict containing profile variable settings as if they had been read in from a profile file, without reading a file. This function is provided for applications which need to use the Droplet library without a profile file.</p>
<p>See <a class="el" href="profile.html">Profile File</a> for details of the profile variables. The droplet directory is set by a special variable in the dict called <code>droplet_dir</code>, and the profile name by a special variable called <code>profile_name</code>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">profile</td><td>a dict containing profile variables </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>a new context or NULL on error </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Oct 17 2013 12:28:24 for Droplet by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.1.2
</small></address>
</body>
</html>
